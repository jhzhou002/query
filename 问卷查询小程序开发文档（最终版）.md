------

# 问卷查询小程序开发文档（最终版）

## 1. 项目定位

本小程序用于 **帮助用户在答问卷之前，快速查询该问卷的注意事项/筛选条件说明**。

- 用户输入：问卷平台 + 问卷编号 + 积分。
- 系统输出：
  - ✅ 正常回答
  - ✅ 筛选条件提示（如：年龄 18-25、职业：学生…）
  - ❌ 暂无该问卷（若后台未录入）

⚠️ **会员限制**：

- 只有会员用户可以查询问卷；
- 非会员用户点击查询时 → 提示 `请联系管理员升级会员`，不显示其他结果。

------

## 2. 功能模块

### 2.1 小程序前端

- **首页**
  - 轮播图（支持后台管理配置）
  - 查询功能：
    - 平台选择（下拉框）
    - 问卷编号输入框
    - 积分输入框
    - 查询按钮
    - 查询结果展示（仅会员可见）
- **我的**
  - 查询记录（仅会员用户可保存/查看）
  - 会员状态
    - 显示会员/非会员
    - 显示会员到期时间（支持永久会员 / 月卡 / 年卡）
    - 激活码输入入口（成为会员）
- **公告**
  - 公告列表（展示系统通知、新功能、维护提醒等）
- **登录**
  - 使用微信快捷登录（微信一键登录）

------

### 2.2 小程序后台管理系统

- **问卷管理**
  - 增删改查问卷信息
  - 字段：平台、问卷编号、积分、筛选条件说明
- **用户管理**
  - 用户列表
  - 会员状态管理（普通/会员）
  - 会员到期时间管理（永久 / 到期时间）
- **激活码管理**
  - 激活码生成/使用情况
  - 支持配置激活码有效期（永久 / 月卡 / 年卡）
- **轮播图管理**
  - 上传/修改/删除轮播图
- **公告管理**
  - 发布公告（标题 + 内容 + 发布时间）
  - 修改/删除公告

------

## 3. 技术栈

- **前端**

  - 微信小程序（原生框架）
  - Vue 3 + Vant Weapp
  - 主题色：浅蓝 + 白色（简约高级）

- **后端**

  - Node.js (Express/Koa)
  - RESTful API

- **数据库**

  - MySQL

  - 配置：

    ```
    host: 101.35.218.174
    username: tongyong
    password: zhjh0704
    database: questionnaire_query
    ```

------

## 4. 数据库设计（核心表）

### 表：questionnaire（问卷表）

| 字段名        | 类型      | 描述                  |
| ------------- | --------- | --------------------- |
| id            | INT PK AI | 问卷 ID               |
| platform      | VARCHAR   | 平台名称              |
| q_number      | VARCHAR   | 问卷编号              |
| reward_points | INT       | 积分                  |
| notes         | TEXT      | 筛选条件说明/注意事项 |

### 表：user（用户表）

| 字段名     | 类型      | 描述                            |
| ---------- | --------- | ------------------------------- |
| id         | INT PK AI | 用户 ID                         |
| openid     | VARCHAR   | 微信 OpenID                     |
| nickname   | VARCHAR   | 微信昵称                        |
| avatar     | VARCHAR   | 微信头像                        |
| is_vip     | TINYINT   | 会员状态 (0=否,1=是)            |
| vip_expire | DATETIME  | 会员到期时间（NULL = 永久会员） |

### 表：activation_code（激活码表）

| 字段名  | 类型      | 描述                                     |
| ------- | --------- | ---------------------------------------- |
| id      | INT PK AI | 激活码 ID                                |
| code    | VARCHAR   | 激活码字符串                             |
| type    | VARCHAR   | 激活码类型（permanent, monthly, yearly） |
| is_used | TINYINT   | 是否使用 (0=否,1=是)                     |
| used_by | INT       | 使用用户 ID                              |
| used_at | DATETIME  | 使用时间                                 |

### 表：query_history（查询记录表）

| 字段名     | 类型      | 描述     |
| ---------- | --------- | -------- |
| id         | INT PK AI | 记录 ID  |
| user_id    | INT       | 用户 ID  |
| q_id       | INT       | 问卷 ID  |
| query_time | DATETIME  | 查询时间 |

### 表：carousel（轮播图表）

| 字段名    | 类型      | 描述             |
| --------- | --------- | ---------------- |
| id        | INT PK AI | 图片 ID          |
| image_url | VARCHAR   | 图片地址         |
| link      | VARCHAR   | 跳转链接（可选） |
| sort      | INT       | 排序值           |

### 表：announcement（公告表）

| 字段名     | 类型      | 描述     |
| ---------- | --------- | -------- |
| id         | INT PK AI | 公告 ID  |
| title      | VARCHAR   | 公告标题 |
| content    | TEXT      | 公告内容 |
| created_at | DATETIME  | 发布时间 |

------

## 5. 用户使用流程

1. 用户进入小程序 → 微信一键登录
2. 点击查询：
   - 若 **非会员用户** → 弹窗提示 `请联系管理员升级会员`
   - 若 **会员用户** → 输入问卷平台 + 编号 + 积分，查询结果：
     - 正常回答
     - 筛选条件说明
     - 暂无该问卷
3. 用户（仅会员）可在“我的”查看查询记录
4. 用户输入激活码 → 成为会员（激活码可配置永久/月卡/年卡）
5. 用户可在“公告”查看最新通知

------

## 6. 查询接口文档

### 接口：查询问卷信息

- **URL**: `/api/query`

- **方法**: `POST`

- **请求参数**:

  ```
  {
    "platform": "问卷星",
    "q_number": "Q12345",
    "reward_points": 10,
    "user_id": 101
  }
  ```

- **返回参数**:

  - **成功（会员用户 + 有结果）**

    ```
    {
      "code": 200,
      "msg": "查询成功",
      "data": {
        "status": "normal", 
        "notes": "年龄:18-25, 职业:学生"
      }
    }
    ```

  - **成功（会员用户 + 无结果）**

    ```
    {
      "code": 200,
      "msg": "暂无该问卷",
      "data": null
    }
    ```

  - **失败（非会员用户）**

    ```
    {
      "code": 403,
      "msg": "请联系管理员升级会员",
      "data": null
    }
    ```

------

## 7. 界面风格

- 浅蓝 + 白色为主色调
- 首页：轮播图 + 输入框 + 查询按钮
- 查询结果区（仅会员可见）
- 我的：查询记录列表 + 会员状态卡片 + 激活码输入框
- 公告：卡片式公告列表